<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TRAVEL EXPLORE</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="dharshan/chatbot.css" />

    <!-- âœ… Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>

<body>

<!-- ==== LOGGED IN HEADER (NO TOP LINKS) ==== -->
<div id="logged-in-header" class="top-links" style="display: none;">
    <a href="#" id="menu-toggle" class="menu-icon">â˜°</a>
    <a href="profile.html" class="user-icon">ğŸ‘¤</a>
</div>

<!-- ==== SIDEBAR ==== -->
<div id="sidebar-menu" class="sidebar">
    <a href="index.html" class="active-link">ğŸ  Home</a>
    <a href="index2.html">ğŸ—ºï¸ Explore</a>
    <a href="index3.html">â„¹ï¸ About us</a>
    <a href="feedback.html">ğŸ—£ï¸ Feedback</a>
    <a href="index4.html">ğŸ“… Trip Planner</a>
    <hr />
    <a href="profile.html">âš™ï¸ Settings / Profile</a>
    <a href="#" id="logout-link" class="logout-link">ğŸšª Log Out</a>
</div>

<h1 style="text-align: center; color: #007bff"><i>Discover Places Near You</i></h1>
<h4 style="text-align: center; color: #555"><i>Your personal travel companion</i></h4>

<!-- ==== CATEGORY SECTION ==== -->
<div class="section">
    <a href="#" onclick="findNearby('hotel'); return false;">
        <img src="hotels.jpeg" /><h3><i>Hotels</i></h3>
    </a>
    <a href="#" onclick="findNearby('restaurant'); return false;">
        <img src="restra.jpeg" /><h3><i>Restaurants</i></h3>
    </a>
    <a href="#" onclick="findNearby('mall'); return false;">
        <img src="shopping.jpeg" /><h3><i>Shopping</i></h3>
    </a>
    <a href="#" onclick="findNearby('travel_agency'); return false;">
        <img src="travel.jpeg" /><h3><i>Travels</i></h3>
    </a>
    <a href="#" onclick="findNearby('cinema'); return false;">
        <img src="cinema.jpeg" /><h3><i>Cinema</i></h3>
    </a>
</div>

<!-- ==== EXPLORE CITIES ==== -->
<section class="explore-section">
    <h2>Explore Top Destinations</h2>
    <div class="destination-grid">
        <div class="destination-card" onclick="openMap('Varanasi')"><img src="varanasi.jpg"><h3>Varanasi</h3></div>
        <div class="destination-card" onclick="openMap('Goa')"><img src="goa.jpg"><h3>Goa</h3></div>
        <div class="destination-card" onclick="openMap('New Delhi')"><img src="delhi.jpg"><h3>New Delhi</h3></div>
        <div class="destination-card" onclick="openMap('Jaipur')"><img src="jaipur.jpg"><h3>Jaipur</h3></div>
        <div class="destination-card" onclick="openMap('Kerala')"><img src="kerala.jpg"><h3>Kerala</h3></div>
        <div class="destination-card" onclick="openMap('Ladakh')"><img src="ladakh.jpg"><h3>Ladakh</h3></div>
    </div>
</section>

<!-- ==== MAP (REPLACED IFRAME) ==== -->
<section id="map-results">
    <h2>Nearby Results (Map View)</h2>
    <div id="map" style="width:100%; height:500px; border-radius:10px;"></div>
</section>

<!-- ==== CHATBOT ==== -->
<button id="chat-toggle">ğŸ’¬</button>
<div id="chatbot-box">
    <div id="chat-header">ğŸ¤– TravelMate</div>
    <div id="chat-body"></div>
    <input type="text" id="chat-input" placeholder="Type your message..." />
</div>

<!-- âœ… Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- ==== JS ==== -->
<script type="module">
import { auth } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

let map, userMarker;

onAuthStateChanged(auth, (user) => {
    if (user) {
        document.getElementById("logged-in-header").style.display = "flex";
        initMap();
    }
});

// âœ… Initialize Map
function initMap() {
    navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        map = L.map('map').setView([lat, lon], 15);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        userMarker = L.marker([lat, lon]).addTo(map).bindPopup("ğŸ“ You are here").openPopup();

    }, () => alert("Please allow location access âœ…"));
}

// âœ… Nearby Places Search (Free, No Key)
window.findNearby = function(tag) {
    navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        const query = `
        [out:json];
        node(around:2000, ${lat}, ${lon})["amenity"="${tag}"];
        out;`;

        fetch("https://overpass-api.de/api/interpreter", { method: "POST", body: query })
        .then(r => r.json())
        .then(data => {
            data.elements.forEach(p => {
                L.marker([p.lat, p.lon]).addTo(map)
                .bindPopup(p.tags.name || "Unknown Place");
            });
        });
    });
};

// âœ… City Search (OpenStreetMap)
window.openMap = function(city) {
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`)
        .then(r => r.json())
        .then(d => map.setView([d[0].lat, d[0].lon], 12));
};

// âœ… Log Out
document.getElementById("logout-link")?.addEventListener("click", (e) => {
    e.preventDefault();
    signOut(auth).then(() => location.reload());
});

// âœ… Sidebar Menu
document.getElementById("menu-toggle")?.addEventListener("click", () =>
    document.getElementById("sidebar-menu").classList.toggle("open")
);
</script>

<script src="dharshan/chatbot.js"></script>
</body>
</html>
